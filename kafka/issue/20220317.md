내용은 계속 확인하여 업데이트 예정

## 개요
- 이슈내용: 100만건 이상의 메시지를 발송중에 N시간 정도 있다가 컨슘(장시간 지연)하여 메시지 발송되어 문제제기
- 이슈감지일: 2022-03-21
- 이슈요청자: 클라이언트
- 이슈기간: 2022-03-17 18시 이후 ~ 2022-03-18 01시 사이

## 현상
- 이슈기간 내 클라이언트에서 발송한 대량건에 대해서 일부 지연이 발생함

## 원인분석
### 내부 파악
- ex) 18시에 100만건이 정상 접수되었고 내부 분배서버에서 정상 분배(토픽으로)하였으나, 메시지 발송 어플리케이션에서 지연하여 컨슘함
- 이로인해 지연 발송 (모든 발송어플리케이션이 그랬던것은 아님)
#### 토픽
- 이슈가 되었던 topic 은 5개, partition 20
#### 어플리케이션 구성
- 4개의 서버에 1개씩 concurrency 5로 5개의 토픽을 컨슘하도록 세팅
- consumer 의 group-id 는 동일

#### 분배서버 로그 확인
- 18시 후반부 부터 접수된 100만건 이상의 데이터는 정상 Produce 하여 분배가 완료된것으로 확인되나,
~~- produce 메서드가 실행된 후 찍는 로그로 정확히 produce 되고 callback 받은 로그가 아니여서 정확하진 않다고 판단~~ 

#### 데이터 확인
| **일자**       | **시간** | **A서버**  | **B서버**   | **C서버**   | **D서버**   |
| -------------- | -------- | ---------- | ----------- | ----------- | ----------- |
| **2022-03-17** | **18**   | **30,000** | **231,000** | **231,000** | **231,000** |
| **2022-03-17** | **19**   | **36,000** | **38,000**  | **38,000**  | **38,000**  |
| **2022-03-17** | **20**   | **36,000** | **200**     | **200**     | **200**     |
| **2022-03-17** | **21**   | **36,000** | **170**     | **170**     | **160**     |
| **2022-03-17** | **22**   | **36,000** | **160**     | **170**     | **170**     |
| **2022-03-17** | **23**   | **35,000** | **120**     | **120**     | **110**     |
| **2022-03-18** | **00**   | **35,000** | **90**      | **91**      | **90**      |
| **2022-03-18** | **01**   | **36,000** | **96**      | **95**      | **97**      |

- 초기에는 19시 이후 데이터만 확인했기 때문에 B,C,D 서버가 이상이 있다고 최초 판단했으나, 걸쳐져 있는 18시까지 확인한 결과 A서버에 문제가 있다고 2차 판단이 된 상태  
- 위 데이터로 미루어 보았을 때, 
  - 이미 토픽에는 100만 건이 정상 produce 되었다고 판단, 
  - 이것을 B,C,D 서버는 이미 18~19시 사이에 전부 처리한 것으로 판단,
  - A 서버는 특정 수치 이상의 포퍼먼스가 안나오는 것으로 보임,


#### 카프카 로그 확인
- 해당 일자의 server.log 파일에는 별다른 로그는 찾아보지 못했음 (~~찾지 못한거일수도 있음~~)
- 
#### 발송 어플리케이션 확인
- 정상으로 보이는 B,C,D 서버와는 다르게 A 서버에서 간헐적으로  `CommitFailedException` 이 발생된 로그가 보임
- `CommitFailedException` 에 대한 내용 추적 진행중


### 의문점
- A,B,C,D 서버에는 동일한 어플리케이션(컨슘하는 토픽은 다름)이 5개씩 있는데 문제가 되는 토픽을 컨슘하는 어플리케이션만 이슈가 있음

## 대응, 조치

## 회고
### 운영 문제점
#### 모니터링
- 모니터링의 부재
#### 알람
- ..
